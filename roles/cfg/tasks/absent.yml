# Copyright (c) 2021 Markus Falb <markus.falb@mafalb.at>
# GNU General Public License v3.0+
# see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt
---

- name: remove cfg files
  block:

  - name: cfg files are replaced
    copy:
      dest: "{{ httpd_template.dest }}"
      content: '# removed file by ansible'
      mode: "{{ httpd_cfg_mode }}"
      backup: true
    loop: "{{ _httpd_templates.template_options }}"
    loop_control:
      loop_var: httpd_template
    when:
    - httpd_template.dest != httpd_main_cfg
    - httpd_conf_d_wr is not defined

  - name: cfg files are absent
    file:
      path: "{{ httpd_conf_d }}/{{ httpd_template.dest|basename }}"
      state: absent
    loop: "{{ _httpd_templates.template_options }}"
    loop_control:
      loop_var: httpd_template
    when:
    - httpd_template.dest != httpd_main_cfg
    notify: reload httpd

...
