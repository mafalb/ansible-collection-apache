# Copyright (c) 2021 Markus Falb <markus.falb@mafalb.at>
# GNU General Public License v3.0+
# see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt
---

- name: apache is present
  package:
    name: "{{ httpd_packages }}"

- name: SCL only
  block:
  - name: SCL only - directory in /etc/opt is present
    file:
      path: /etc/opt/{{ scl_provider }}
      state: directory
      mode: "0755"
  - name: SCL only - symlink in /etc/opt is present
    file:
      src: "{{ httpd_basedir }}"
      dest: /etc/opt/{{ scl_provider }}/{{ scl_prefix }}
      state: link
  when: scl_prefix is defined

- name: directory for vhosts config is present
  block:
  - name: additional directories are present
    file:
      path: "{{ httpd_vhosts_d }}"
      state: directory
      mode: '755'
  when: not httpd_has_vhosts_d

- name: apache config is present
  include_role:
    name: mafalb.apache.cfg

- name: apache is started
  service:
    name: "{{ httpd_service }}"
    state: started
    enabled: "{{ httpd_service_enabled }}"
  register: _httpd_has_started

...
