# vim: set ft=yaml ts=2 expandtab:
---

- name: converge apache
  hosts: all,!infrastructure_group

  environment:
    http_proxy: http://ci-proxy:3128
    https_proxy: http://ci-proxy:3128

  roles:

  - role: mafalb.scl.rh
    httpd_different_vhosts_d: conf.vhosts.d

  - role: mafalb.apache.httpd
    httpd_different_vhosts_d: conf.vhosts.d
    scl_prefix: httpd24

  - role: mafalb.apache.httpd
    scl_prefix: httpd24
    httpd_different_vhosts_d: conf.vhosts.d
    httpd_templates:
    - src: vhosts.conf.j2
      dest: vhosts.conf

  - role: _ci.httpd
    scl: true

  tasks:

  - name: index.html is present
    copy:
      content: "{{ ansible_host }}"
      dest: "/opt/rh/httpd24/root/var/www/html/index.html"
      mode: '644'

...
